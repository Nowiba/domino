<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domino Elite</title>
    <style>
        :root {
            --primary: #1a1a2e;
            --secondary: #16213e;
            --accent: #e94560;
            --text: #f5f5f5;
            --wood: #8B4513;
            --tile: #fffaf0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--primary);
            font-family: 'Helvetica Neue', Arial, sans-serif;
            min-height: 100vh;
            padding: 20px;
            max-width: 1080px;
            margin: 0 auto;
            color: var(--text);
            overflow-x: hidden;
        }

        .game-wrapper {
            background: var(--secondary);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
        }

        .status {
            font-size: 20px;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .stats {
            font-size: 14px;
            opacity: 0.8;
        }

        .board {
            background: var(--wood);
            border-radius: 15px;
            padding: 20px;
            min-height: 400px;
            display: flex;
            gap: 15px;
            overflow-x: auto;
            align-items: center;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .player-hand {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            display: flex;
            gap: 10px;
            overflow-x: auto;
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            max-width: 1040px;
            margin: 0 auto;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.2);
        }

        .domino {
            width: 80px;
            height: 160px;
            background: var(--tile);
            border-radius: 12px;
            border: 2px solid #333;
            display: flex;
            flex-direction: column;
            box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.3);
            cursor: grab;
            transition: all 0.2s ease;
            position: relative;
        }

        .domino:hover {
            transform: translateY(-5px);
            box-shadow: 3px 3px 12px rgba(0, 0, 0, 0.4);
        }

        .domino-half {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            padding: 10px;
            position: relative;
        }

        .domino-half::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 10%;
            width: 80%;
            height: 2px;
            background: #333;
        }

        .domino-half:last-child::after {
            display: none;
        }

        .pip {
            width: 14px;
            height: 14px;
            background: #2c2c2c;
            border-radius: 50%;
            margin: auto;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            padding: 20px 0;
        }

        .btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: var(--accent);
            color: var(--text);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            background: #c7324d;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(233, 69, 96, 0.3);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-box {
            background: var(--secondary);
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 550px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
        }

        .modal-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 25px;
            text-align: center;
            color: var(--accent);
        }

        .modal-section {
            margin-bottom: 25px;
        }

        .modal-label {
            display: block;
            font-size: 18px;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .modal-select {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
            font-size: 16px;
            cursor: pointer;
        }

        .modal-select option {
            background: var(--secondary);
        }

        .score-bar {
            font-size: 16px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <div class="header">
            <div class="status" id="gameStatus">Domino Elite</div>
            <div class="stats" id="gameStats">Score: 0 | Opponents: 0</div>
        </div>
        <div class="board" id="gameBoard"></div>
        <div class="player-hand" id="playerHand"></div>
        <div class="controls">
            <button class="btn" id="drawBtn">Draw Tile</button>
            <button class="btn" id="passBtn">Pass Turn</button>
            <button class="btn" id="newGameBtn">New Game</button>
            <button class="btn" id="rulesBtn">Rules</button>
        </div>
        <div class="score-bar" id="scoreBar">Player 1: 0 | Bot Scores: 0-0-0</div>
    </div>

    <div class="modal" id="setupModal">
        <div class="modal-box">
            <div class="modal-title">Game Setup</div>
            <div class="modal-section">
                <label class="modal-label">Players:</label>
                <select class="modal-select" id="playerCount">
                    <option value="2">2 Players (1v1)</option>
                    <option value="3">3 Players (1v2)</option>
                    <option value="4">4 Players</option>
                </select>
            </div>
            <div class="modal-section" id="modeSection" style="display: none;">
                <label class="modal-label">Mode:</label>
                <select class="modal-select" id="gameMode">
                    <option value="ffa">Free For All</option>
                    <option value="teams">2 vs 2</option>
                </select>
            </div>
            <button class="btn" id="startBtn">Start Game</button>
        </div>
    </div>

    <div class="modal" id="rulesModal">
        <div class="modal-box">
            <div class="modal-title">Game Rules</div>
            <div class="modal-section">
                <p>1. Game begins with highest double</p>
                <p>2. Match tile ends with same number</p>
                <p>3. Draw from boneyard if stuck</p>
                <p>4. Pass if no moves available</p>
                <p>5. Win by playing all tiles</p>
                <p>6. Score from opponents' remaining tiles</p>
                <p>7. Teams combine scores in 2v2</p>
                <p>8. First to 100 points wins</p>
            </div>
            <button class="btn" id="closeRulesBtn">Close</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

    <script>
        // Firebase Setup
        const firebaseConfig = {
  apiKey: "AIzaSyBazU0aKcpX7sxhPrcyYQYryRrYW1i0rdk",
  authDomain: "sample-firebase-ai-f5447.firebaseapp.com",
  projectId: "sample-firebase-ai-f5447",
  storageBucket: "sample-firebase-ai-f5447.firebasestorage.app",
  messagingSenderId: "718125971250",
  appId: "1:718125971250:web:438339203c5657ddfc492b"
};
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const gameRef = db.ref('game');

        // Game State
        const game = {
            players: [],
            board: [],
            boneyard: [],
            currentPlayer: 0,
            mode: 'ffa',
            scores: {},
            active: false,
            target: 100
        };

        // DOM Elements
        const els = {
            status: document.getElementById('gameStatus'),
            stats: document.getElementById('gameStats'),
            board: document.getElementById('gameBoard'),
            hand: document.getElementById('playerHand'),
            drawBtn: document.getElementById('drawBtn'),
            passBtn: document.getElementById('passBtn'),
            newGameBtn: document.getElementById('newGameBtn'),
            rulesBtn: document.getElementById('rulesBtn'),
            scoreBar: document.getElementById('scoreBar'),
            setupModal: document.getElementById('setupModal'),
            playerCount: document.getElementById('playerCount'),
            modeSection: document.getElementById('modeSection'),
            gameMode: document.getElementById('gameMode'),
            startBtn: document.getElementById('startBtn'),
            rulesModal: document.getElementById('rulesModal'),
            closeRulesBtn: document.getElementById('closeRulesBtn')
        };

        // Game Logic
        function createTiles() {
            const tiles = [];
            for (let i = 0; i <= 6; i++) {
                for (let j = i; j <= 6; j++) {
                    tiles.push([i, j]);
                }
            }
            return tiles;
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function renderDomino(tile, draggable, index, playerIdx) {
            const domino = document.createElement('div');
            domino.className = 'domino';
            domino.dataset.tile = JSON.stringify(tile);
            domino.dataset.index = index;
            domino.dataset.player = playerIdx;

            if (draggable && playerIdx === 0) {
                domino.draggable = true;
                domino.addEventListener('dragstart', dragStart);
            }

            const pipPatterns = {
                0: [],
                1: [[1, 1]],
                2: [[0, 0], [2, 2]],
                3: [[0, 0], [1, 1], [2, 2]],
                4: [[0, 0], [0, 2], [2, 0], [2, 2]],
                5: [[0, 0], [0, 2], [1, 1], [2, 0], [2, 2]],
                6: [[0, 0], [0, 1], [0, 2], [2, 0], [2, 1], [2, 2]]
            };

            tile.forEach(num => {
                const half = document.createElement('div');
                half.className = 'domino-half';
                pipPatterns[num].forEach(([x, y]) => {
                    const pip = document.createElement('div');
                    pip.className = 'pip';
                    pip.style.gridColumn = x + 1;
 uplift                   pip.style.gridRow = y + 1;
                    half.appendChild(pip);
                });
                domino.appendChild(half);
            });

            return domino;
        }

        async function startGame(playerCount, mode) {
            const tiles = shuffle(createTiles());
            game.players = [];
            game.scores = {};
            game.mode = mode;
            game.active = true;

            for (let i = 0; i < playerCount; i++) {
                game.players.push({
                    hand: tiles.splice(0, 7),
                    isBot: i !== 0,
                    team: mode === 'teams' ? (i < 2 ? 0 : 1) : i
                });
                game.scores[i] = 0;
            }

            const state = {
                players: game.players,
                board: [],
                boneyard: tiles,
                currentPlayer: findFirstPlayer(),
                mode: mode,
                scores: game.scores,
                active: true
            };

            await gameRef.set(state);
        }

        function findFirstPlayer() {
            let maxDouble = -1;
            let first = 0;
            game.players.forEach((p, i) => {
                p.hand.forEach(t => {
                    if (t[0] === t[1] && t[0] > maxDouble) {
                        maxDouble = t[0];
                        first = i;
                    }
                });
            });
            return first;
        }

        function syncGame() {
            gameRef.on('value', snapshot => {
                const data = snapshot.val();
                if (data) {
                    Object.assign(game, data);
                    render();
                    if (game.active && game.players[game.currentPlayer].isBot) {
                        setTimeout(botMove, 1500);
                    }
                }
            });
        }

        function render() {
            els.board.innerHTML = '';
            game.board.forEach((t, i) => {
                els.board.appendChild(renderDomino(t, false, i, -1));
            });

            els.hand.innerHTML = '';
            game.players[0].hand.forEach((t, i) => {
                els.hand.appendChild(renderDomino(t, true, i, 0));
            });

            els.status.textContent = game.active ? 
                `Player ${game.currentPlayer + 1}'s Turn` : 
                'Game Over';
            
            const botHands = game.players.slice(1).map(p => p.hand.length).join('-');
            els.stats.textContent = `Score: ${game.scores[0]} | Opponents: ${botHands}`;
            els.scoreBar.textContent = `Player 1: ${game.scores[0]} | Bot Scores: ${Object.values(game.scores).slice(1).join('-')}`;

            els.drawBtn.disabled = !game.active || game.currentPlayer !== 0 || game.boneyard.length === 0;
            els.passBtn.disabled = !game.active || game.currentPlayer !== 0;
        }

        async function playTile(playerIdx, tileIdx, side) {
            if (!game.active || playerIdx !== game.currentPlayer) return;
            const tile = game.players[playerIdx].hand[tileIdx];
            if (!canPlay(tile, side)) return;

            let played = [...tile];
            if (game.board.length) {
                if (side === 'left') {
                    if (played[1] !== game.board[0][0]) played = [played[1], played[0]];
                } else {
                    if (played[0] !== game.board[game.board.length - 1][1]) played = [played[1], played[0]];
                }
            }

            const newPlayers = [...game.players];
            newPlayers[playerIdx].hand.splice(tileIdx, 1);
            const newBoard = side === 'left' ? [played, ...game.board] : [...game.board, played];
            await updateState({ players: newPlayers, board: newBoard });
        }

        async function draw() {
            if (!game.active || game.currentPlayer !== 0 || game.boneyard.length === 0) return;
            const newPlayers = [...game.players];
            newPlayers[0].hand.push(game.boneyard[0]);
            const newBoneyard = game.boneyard.slice(1);
            await updateState({ players: newPlayers, boneyard: newBoneyard });
        }

        async function pass() {
            if (!game.active || game.currentPlayer !== 0) return;
            await nextPlayer();
        }

        async function botMove() {
            if (!game.active || !game.players[game.currentPlayer].isBot) return;
            const hand = game.players[game.currentPlayer].hand;

            for (let i = 0; i < hand.length; i++) {
                if (canPlay(hand[i], 'left')) return await playTile(game.currentPlayer, i, 'left');
                if (canPlay(hand[i], 'right')) return await playTile(game.currentPlayer, i, 'right');
            }

            if (game.boneyard.length) {
                const newPlayers = [...game.players];
                newPlayers[game.currentPlayer].hand.push(game.boneyard[0]);
                const newBoneyard = game.boneyard.slice(1);
                await updateState({ players: newPlayers, boneyard: newBoneyard });
            } else {
                await nextPlayer();
            }
        }

        async function nextPlayer() {
            const next = (game.currentPlayer + 1) % game.players.length;
            await updateState({ currentPlayer: next });
        }

        async function updateState(changes) {
            const newState = { ...game, ...changes };
            if (newState.players[newState.currentPlayer].hand.length === 0) {
                calculateScores(newState);
                newState.active = false;
            }
            await gameRef.set(newState);
        }

        function canPlay(tile, side) {
            if (!game.board.length) return tile[0] === tile[1];
            const left = game.board[0][0];
            const right = game.board[game.board.length - 1][1];
            return side === 'left' ? 
                (tile[0] === left || tile[1] === left) : 
                (tile[0] === right || tile[1] === right);
        }

        function calculateScores(state) {
            state.players.forEach((p, i) => {
                const value = p.hand.reduce((sum, t) => sum + t[0] + t[1], 0);
                if (state.mode === 'teams') {
                    const team = p.team;
                    state.scores[team] = (state.scores[team] || 0) + (i === state.currentPlayer ? 0 : value);
                } else {
                    state.scores[i] = (state.scores[i] || 0) + (i === state.currentPlayer ? 0 : value);
                }
            });
        }

        // Event Handlers
        function dragStart(e) {
            if (game.currentPlayer !== 0) return;
            e.dataTransfer.setData('text/plain', JSON.stringify({
                index: e.target.dataset.index,
                player: e.target.dataset.player
            }));
        }

        function dragOver(e) {
            e.preventDefault();
        }

        function drop(e) {
            e.preventDefault();
            if (game.currentPlayer !== 0) return;
            const data = JSON.parse(e.dataTransfer.getData('text/plain'));
            const side = e.offsetX < els.board.offsetWidth / 2 ? 'left' : 'right';
            playTile(parseInt(data.player), parseInt(data.index), side);
        }

        // Modal Controls
        function showSetup() {
            els.setupModal.style.display = 'flex';
            els.playerCount.onchange = () => {
                els.modeSection.style.display = els.playerCount.value === '4' ? 'block' : 'none';
            };
        }

        function hideSetup() {
            els.setupModal.style.display = 'none';
        }

        function showRules() {
            els.rulesModal.style.display = 'flex';
        }

        function hideRules() {
            els.rulesModal.style.display = 'none';
        }

        // Event Listeners
        els.newGameBtn.addEventListener('click', showSetup);
        els.startBtn.addEventListener('click', async () => {
            await startGame(parseInt(els.playerCount.value), 
                els.playerCount.value === '4' ? els.gameMode.value : 'ffa');
            hideSetup();
        });

        els.drawBtn.addEventListener('click', draw);
        els.passBtn.addEventListener('click', pass);
        els.rulesBtn.addEventListener('click', showRules);
        els.closeRulesBtn.addEventListener('click', hideRules);

        els.board.addEventListener('dragover', dragOver);
        els.board.addEventListener('drop', drop);

        // Start
        syncGame();
        showSetup();
    </script>
</body>
</html>
