<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domino Masters</title>
    <style>
        body {
            margin: 0;
            padding: 15px;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            font-family: 'Segoe UI', Arial, sans-serif;
            max-width: 1080px;
            margin: 0 auto;
            color: #fff;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .status-bar {
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .board-container {
            background: #2d1b12;
            border-radius: 15px;
            padding: 20px;
            min-height: 350px;
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            gap: 10px;
            align-items: center;
            justify-content: flex-start;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .player-area {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 15px;
            position: fixed;
            bottom: 15px;
            left: 15px;
            right: 15px;
            max-width: 1050px;
            margin: 0 auto;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.3);
        }

        .domino {
            width: 70px;
            height: 140px;
            background: #f5f5f5;
            border: 3px solid #333;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.4);
            cursor: move;
            transition: transform 0.2s;
        }

        .domino:hover {
            transform: scale(1.05);
        }

        .domino-half {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            border-bottom: 2px solid #333;
        }

        .domino-half:last-child {
            border-bottom: none;
        }

        .pip-container {
            width: 100%;
            height: 100%;
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
        }

        .pip {
            width: 12px;
            height: 12px;
            background: #2c3e50;
            border-radius: 50%;
            margin: auto;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            padding: 15px 0;
        }

        .game-button {
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: #ff4444;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            text-transform: uppercase;
        }

        .game-button:hover {
            background: #cc0000;
            transform: translateY(-2px);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: #fff;
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            color: #333;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .modal-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #2c3e50;
            text-align: center;
        }

        .modal-section {
            margin-bottom: 20px;
        }

        .modal-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        .modal-select {
            width: 100%;
            padding: 10px;
            border: 2px solid #2c3e50;
            border-radius: 8px;
            font-size: 16px;
            background: #f5f5f5;
        }

        .stats-panel {
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="status-bar" id="statusBar">Welcome to Domino Masters</div>
        <div class="stats-panel" id="statsPanel">
            Player Score: 0 | Bots: 0-0-0 | Tiles Remaining: 28
        </div>
        <div class="board-container" id="gameBoard"></div>
        <div class="player-area">
            <div id="playerHand"></div>
        </div>
        <div class="controls">
            <button class="game-button" id="drawButton">Draw</button>
            <button class="game-button" id="passButton">Pass</button>
            <button class="game-button" id="newGameButton">New Game</button>
            <button class="game-button" id="rulesButton">Rules</button>
        </div>
    </div>

    <div class="modal" id="setupModal">
        <div class="modal-content">
            <div class="modal-title">Game Setup</div>
            <div class="modal-section">
                <label class="modal-label">Number of Players:</label>
                <select class="modal-select" id="playerCountSelect">
                    <option value="2">2 Players (1 vs 1)</option>
                    <option value="3">3 Players (1 vs 2)</option>
                    <option value="4">4 Players</option>
                </select>
            </div>
            <div class="modal-section" id="modeSection" style="display: none;">
                <label class="modal-label">Game Mode:</label>
                <select class="modal-select" id="gameModeSelect">
                    <option value="ffa">Free For All</option>
                    <option value="teams">2 vs 2 Teams</option>
                </select>
            </div>
            <button class="game-button" id="startGameButton">Start Game</button>
        </div>
    </div>

    <div class="modal" id="rulesModal">
        <div class="modal-content">
            <div class="modal-title">Game Rules</div>
            <div class="modal-section">
                <p>1. Highest double starts the game</p>
                <p>2. Match numbers on either end</p>
                <p>3. Draw when no playable tiles</p>
                <p>4. Pass if unable to play</p>
                <p>5. Win by emptying hand</p>
                <p>6. Score based on opponents' tiles</p>
                <p>7. Teams combine scores in 2v2</p>
                <p>8. First to 100 wins</p>
            </div>
            <button class="game-button" id="closeRulesButton">Close</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBazU0aKcpX7sxhPrcyYQYryRrYW1i0rdk",
            authDomain: "sample-firebase-ai-f5447.firebaseapp.com",
            projectId: "sample-firebase-ai-f5447",
            storageBucket: "sample-firebase-ai-f5447.firebasestorage.app",
            messagingSenderId: "718125971250",
            appId: "1:718125971250:web:438339203c5657ddfc492b"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const gameRef = db.ref('game');

        // Game State
        const gameState = {
            players: [],
            board: [],
            boneyard: [],
            currentPlayer: 0,
            gameMode: 'ffa',
            scores: {},
            gameActive: false,
            targetScore: 100
        };

        // DOM Elements
        const elements = {
            statusBar: document.getElementById('statusBar'),
            statsPanel: document.getElementById('statsPanel'),
            gameBoard: document.getElementById('gameBoard'),
            playerHand: document.getElementById('playerHand'),
            drawButton: document.getElementById('drawButton'),
            passButton: document.getElementById('passButton'),
            newGameButton: document.getElementById('newGameButton'),
            rulesButton: document.getElementById('rulesButton'),
            setupModal: document.getElementById('setupModal'),
            playerCountSelect: document.getElementById('playerCountSelect'),
            modeSection: document.getElementById('modeSection'),
            gameModeSelect: document.getElementById('gameModeSelect'),
            startGameButton: document.getElementById('startGameButton'),
            rulesModal: document.getElementById('rulesModal'),
            closeRulesButton: document.getElementById('closeRulesButton')
        };

        // Game Functions
        function generateTiles() {
            const tiles = [];
            for (let i = 0; i <= 6; i++) {
                for (let j = i; j <= 6; j++) {
                    tiles.push([i, j]);
                }
            }
            return tiles;
        }

        function shuffleTiles(tiles) {
            for (let i = tiles.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [tiles[i], tiles[j]] = [tiles[j], tiles[i]];
            }
            return tiles;
        }

        function createDominoElement(tile, draggable, index, playerIndex) {
            const domino = document.createElement('div');
            domino.className = 'domino';
            domino.dataset.tile = JSON.stringify(tile);
            domino.dataset.index = index;
            domino.dataset.player = playerIndex;

            if (draggable && playerIndex === 0) {
                domino.draggable = true;
                domino.addEventListener('dragstart', handleDragStart);
            }

            const pipPatterns = {
                0: [],
                1: [[1, 1]],
                2: [[0, 0], [2, 2]],
                3: [[0, 0], [1, 1], [2, 2]],
                4: [[0, 0], [0, 2], [2, 0], [2, 2]],
                5: [[0, 0], [0, 2], [1, 1], [2, 0], [2, 2]],
                6: [[0, 0], [0, 1], [0, 2], [2, 0], [2, 1], [2, 2]]
            };

            [tile[0], tile[1]].forEach((num, i) => {
                const half = document.createElement('div');
                half.className = 'domino-half';
                const pips = document.createElement('div');
                pips.className = 'pip-container';
                
                pipPatterns[num].forEach(([x, y]) => {
                    const pip = document.createElement('div');
                    pip.className = 'pip';
                    pip.style.gridColumn = x + 1;
                    pip.style.gridRow = y + 1;
                    pips.appendChild(pip);
                });

                half.appendChild(pips);
                domino.appendChild(half);
            });

            return domino;
        }

        async function initializeGame(playerCount, mode) {
            const allTiles = shuffleTiles(generateTiles());
            const tilesPerPlayer = 7;
            gameState.players = [];
            gameState.scores = {};
            gameState.gameMode = mode;
            gameState.gameActive = true;

            for (let i = 0; i < playerCount; i++) {
                const hand = allTiles.splice(0, tilesPerPlayer);
                gameState.players.push({
                    hand: hand,
                    isBot: i !== 0,
                    team: mode === 'teams' ? (i < 2 ? 0 : 1) : i
                });
                gameState.scores[i] = 0;
            }

            const initialState = {
                players: gameState.players,
                board: [],
                boneyard: allTiles,
                currentPlayer: findStartingPlayer(),
                gameMode: mode,
                scores: gameState.scores,
                gameActive: true
            };

            await gameRef.set(initialState);
        }

        function findStartingPlayer() {
            let highestDouble = -1;
            let startingPlayer = 0;

            gameState.players.forEach((player, index) => {
                player.hand.forEach(tile => {
                    if (tile[0] === tile[1] && tile[0] > highestDouble) {
                        highestDouble = tile[0];
                        startingPlayer = index;
                    }
                });
            });
            return startingPlayer;
        }

        function listenToGameState() {
            gameRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    Object.assign(gameState, data);
                    renderGame();
                    if (gameState.gameActive && gameState.players[gameState.currentPlayer].isBot) {
                        setTimeout(botTurn, 1000);
                    }
                }
            });
        }

        function renderGame() {
            elements.gameBoard.innerHTML = '';
            gameState.board.forEach((tile, index) => {
                const domino = createDominoElement(tile, false, index, -1);
                elements.gameBoard.appendChild(domino);
            });

            elements.playerHand.innerHTML = '';
            gameState.players[0].hand.forEach((tile, index) => {
                const domino = createDominoElement(tile, true, index, 0);
                elements.playerHand.appendChild(domino);
            });

            const botScores = gameState.players.slice(1).map(p => p.hand.length).join('-');
            elements.statsPanel.textContent = 
                `Player Score: ${gameState.scores[0]} | Bots: ${botScores} | Tiles Remaining: ${gameState.boneyard.length}`;
            
            elements.statusBar.textContent = gameState.gameActive ?
                `Player ${gameState.currentPlayer + 1}'s Turn` :
                'Game Over - Start New Game';
            
            elements.drawButton.disabled = !gameState.gameActive || 
                gameState.currentPlayer !== 0 || 
                gameState.boneyard.length === 0;
            elements.passButton.disabled = !gameState.gameActive || 
                gameState.currentPlayer !== 0;
        }

        async function playTile(playerIndex, tileIndex, side) {
            if (!gameState.gameActive || playerIndex !== gameState.currentPlayer) return;
            
            const tile = gameState.players[playerIndex].hand[tileIndex];
            if (!canPlayTile(tile, side)) return;

            let playedTile = [...tile];
            if (gameState.board.length > 0) {
                if (side === 'left') {
                    if (playedTile[1] !== gameState.board[0][0]) {
                        playedTile = [playedTile[1], playedTile[0]];
                    }
                } else {
                    if (playedTile[0] !== gameState.board[gameState.board.length - 1][1]) {
                        playedTile = [playedTile[1], playedTile[0]];
                    }
                }
            }

            const newPlayers = [...gameState.players];
            newPlayers[playerIndex].hand.splice(tileIndex, 1);
            const newBoard = side === 'left' ? 
                [playedTile, ...gameState.board] : 
                [...gameState.board, playedTile];

            await updateGameState({ players: newPlayers, board: newBoard });
        }

        async function drawTile() {
            if (!gameState.gameActive || gameState.currentPlayer !== 0 || gameState.boneyard.length === 0) return;
            
            const newPlayers = [...gameState.players];
            const tile = gameState.boneyard[0];
            newPlayers[0].hand.push(tile);
            const newBoneyard = gameState.boneyard.slice(1);
            
            await updateGameState({ players: newPlayers, boneyard: newBoneyard });
        }

        async function passTurn() {
            if (!gameState.gameActive || gameState.currentPlayer !== 0) return;
            await nextTurn();
        }

        async function botTurn() {
            if (!gameState.gameActive || !gameState.players[gameState.currentPlayer].isBot) return;

            const botHand = gameState.players[gameState.currentPlayer].hand;
            let played = false;

            for (let i = 0; i < botHand.length && !played; i++) {
                const tile = botHand[i];
                if (canPlayTile(tile, 'left')) {
                    await playTile(gameState.currentPlayer, i, 'left');
                    played = true;
                } else if (canPlayTile(tile, 'right')) {
                    await playTile(gameState.currentPlayer, i, 'right');
                    played = true;
                }
            }

            if (!played && gameState.boneyard.length > 0) {
                const newPlayers = [...gameState.players];
                const tile = gameState.boneyard[0];
                newPlayers[gameState.currentPlayer].hand.push(tile);
                const newBoneyard = gameState.boneyard.slice(1);
                await updateGameState({ players: newPlayers, boneyard: newBoneyard });
            } else if (!played) {
                await nextTurn();
            }
        }

        async function nextTurn() {
            const nextPlayer = (gameState.currentPlayer + 1) % gameState.players.length;
            await updateGameState({ currentPlayer: nextPlayer });
        }

        async function updateGameState(updates) {
            const newState = { ...gameState, ...updates };
            if (newState.players[newState.currentPlayer].hand.length === 0) {
                calculateScores(newState);
                newState.gameActive = false;
            }
            await gameRef.set(newState);
        }

        function canPlayTile(tile, side) {
            if (gameState.board.length === 0) return tile[0] === tile[1];
            const leftEnd = gameState.board[0][0];
            const rightEnd = gameState.board[gameState.board.length - 1][1];
            return side === 'left' ? 
                (tile[0] === leftEnd || tile[1] === leftEnd) :
                (tile[0] === rightEnd || tile[1] === rightEnd);
        }

        function calculateScores(state) {
            state.players.forEach((player, index) => {
                const handValue = player.hand.reduce((sum, tile) => sum + tile[0] + tile[1], 0);
                if (state.gameMode === 'teams') {
                    const team = player.team;
                    state.scores[team] = (state.scores[team] || 0) + 
                        (index === state.currentPlayer ? 0 : handValue);
                } else {
                    state.scores[index] = (state.scores[index] || 0) + 
                        (index === state.currentPlayer ? 0 : handValue);
                }
            });
        }

        // Event Handlers
        function handleDragStart(e) {
            if (gameState.currentPlayer !== 0) return;
            e.dataTransfer.setData('text/plain', JSON.stringify({
                index: e.target.dataset.index,
                player: e.target.dataset.player
            }));
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDrop(e) {
            e.preventDefault();
            if (gameState.currentPlayer !== 0) return;
            const data = JSON.parse(e.dataTransfer.getData('text/plain'));
            const side = e.offsetX < elements.gameBoard.offsetWidth / 2 ? 'left' : 'right';
            playTile(parseInt(data.player), parseInt(data.index), side);
        }

        // Modal Controls
        function showSetupModal() {
            elements.setupModal.style.display = 'flex';
            elements.playerCountSelect.onchange = () => {
                elements.modeSection.style.display = 
                    elements.playerCountSelect.value === '4' ? 'block' : 'none';
            };
        }

        function hideSetupModal() {
            elements.setupModal.style.display = 'none';
        }

        function showRulesModal() {
            elements.rulesModal.style.display = 'flex';
        }

        function hideRulesModal() {
            elements.rulesModal.style.display = 'none';
        }

        // Event Listeners
        elements.newGameButton.addEventListener('click', showSetupModal);
        elements.startGameButton.addEventListener('click', async () => {
            const playerCount = parseInt(elements.playerCountSelect.value);
            const mode = playerCount === 4 ? elements.gameModeSelect.value : 'ffa';
            await initializeGame(playerCount, mode);
            hideSetupModal();
        });

        elements.drawButton.addEventListener('click', drawTile);
        elements.passButton.addEventListener('click', passTurn);
        elements.rulesButton.addEventListener('click', showRulesModal);
        elements.closeRulesButton.addEventListener('click', hideRulesModal);

        elements.gameBoard.addEventListener('dragover', handleDragOver);
        elements.gameBoard.addEventListener('drop', handleDrop);

        // Initialize
        listenToGameState();
        showSetupModal();
    </script>
</body>
                </html>
